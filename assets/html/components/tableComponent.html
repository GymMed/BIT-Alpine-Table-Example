<!-- Needed elements for component! -->
<!-- <script src="../../js/person.js"></script> -->
<script>
    window.tableData = function () {
        return {
            data: [],
            updateIndexValue: "",
            firstNameValue: "",
            lastNameValue: "",
            ageValue: "",
            nationalityValue: "",
            addResultMessage: "",
            addShowResult: false,
            isAddSuccessResult: false,
            //remove
            removeIndexValue: "1",
            removeResultMessage: "",
            removeShowResult: false,
            isRemoveSuccessResult: false,
            addPerson() {
                // let test = new Person("Joe", "Dalis", "29", "Russian");
                this.addShowResult = true;

                if (
                    this.firstNameValue === "" ||
                    this.lastNameValue === "" ||
                    this.ageValue === "" ||
                    this.nationalityValue === ""
                ) {
                    this.addResultMessage =
                        "You need to fill all inputs to add value!";
                    this.isAddSuccessResult = false;
                    return;
                }

                //- 1 because we need to get current index
                //not representation index
                let updateIndex = parseInt(this.updateIndexValue) - 1;

                if (!this.isInArraySize(this.data, updateIndex)) {
                    this.data.push(
                        new Person(
                            this.firstNameValue,
                            this.lastNameValue,
                            this.ageValue,
                            this.nationalityValue
                        )
                    );
                    this.addResultMessage =
                        "Successfully added person to the table!";
                    this.isAddSuccessResult = true;
                    this.resetAddInputs();
                    return;
                }

                this.updatePerson(
                    this.data[updateIndex],
                    this.firstNameValue,
                    this.lastNameValue,
                    this.ageValue,
                    this.nationalityValue
                );
                this.updateIndexValue = this.data.length + 1;
                this.addResultMessage =
                    "Successfully updated person within a table!";
                this.isAddSuccessResult = true;
                this.resetAddInputs();
            },
            isInArraySize(array, value) {
                if (!Array.isArray(array)) {
                    return false;
                } else if (
                    isNaN(value) ||
                    value < 0 ||
                    !Array.isArray(array) ||
                    value > array.length - 1
                ) {
                    return false;
                }
                return true;
            },
            setPersonDataIndextoInputs(personIndex) {
                const representingIndex = personIndex + 1;
                this.updateIndexValue = representingIndex;
                this.removeIndexValue = representingIndex;
                this.setPersonDataToAddInputs(this.data[personIndex]);
            },
            setPersonDataToAddInputs(personData) {
                if (!(personData instanceof Person)) return;

                this.firstNameValue = personData.getFirstName();
                this.lastNameValue = personData.getLastName();
                this.ageValue = personData.getAge();
                this.nationalityValue = personData.getNationality();
            },
            resetAddInputs() {
                this.firstNameValue = "";
                this.lastNameValue = "";
                this.ageValue = "";
                this.nationalityValue = "";
            },
            updatePerson(
                person,
                firstName = "",
                lastName = "",
                age = "0",
                nationality = "Lithuanian"
            ) {
                person.setFirstName(firstName);
                person.setLastName(lastName);
                person.setAge(age);
                person.setNationality(nationality);
            },
            removePerson() {
                let removeIndex = parseInt(this.removeIndexValue) - 1;
                this.removeShowResult = true;

                if (
                    isNaN(removeIndex) ||
                    removeIndex < 0 ||
                    removeIndex > this.data.length
                ) {
                    this.isRemoveSuccessResult = false;
                    this.removeResultMessage = "Provided Invalid Index!";
                    return;
                }
                this.data.splice(removeIndex, 1);
                this.isRemoveSuccessResult = true;
                this.removeResultMessage =
                    "Successfully removed person from table!";
            },
        };
    };
</script>
<div x-data="tableData();" x-init="" class="flex flex-col gap-3">
    <table class="w-full border-collapse rounded-lg overflow-hidden">
        <thead class="rounded-lg shadow-lg">
            <tr
                class="text-white bg-gradient-to-br from-purple-500 to-purple-700 rounded-lg"
            >
                <template x-for="header in Person.columnsNames">
                    <th x-text="header" class="py-3"></th>
                </template>
            </tr>
        </thead>
        <tbody class="">
            <template x-for="(record, index) in data">
                <tr
                    class="bg-gradient-to-br rounded-xl hover:text-white hover:from-purple-500 hover:to-purple-700"
                    @click="setPersonDataIndextoInputs(index);"
                >
                    <td x-text="(index + 1) + '.'" class="text-center"></td>
                    <template x-for="column in record">
                        <td x-text="column" class="text-center"></td>
                    </template>
                </tr>
            </template>
        </tbody>
    </table>
    <div class="flex flex-col gap-3">
        <div
            class="p-3 text-white font-bold bg-gradient-to-br rounded-lg shadow-lg"
            :class="{'from-green-500 to-green-700': isAddSuccessResult, 
                'from-red-500 to-red-700': !isAddSuccessResult}"
            x-show="addShowResult"
            x-text="addResultMessage"
        ></div>
        <form action="" class="flex flex-col gap-3">
            <div class="flex flex-col gap-3" x-show="data.length > 0">
                <label for="updateIndex">Update Index:</label>
                <input
                    type="text"
                    name="updateIndex"
                    id="updateIndex"
                    placeholder="Index . . ."
                    class="w-full h-full p-2 border-2 rounded-md focus:ring-blue-500 focus:ring focus:ring-offset-2 focus:ring-offset-white"
                    x-model="updateIndexValue"
                />
            </div>
            <div class="flex flex-col gap-3">
                <label for="firstName">First Name:</label>
                <input
                    type="text"
                    name="firstName"
                    id="firstName"
                    placeholder="First Name . . ."
                    class="w-full h-full p-2 border-2 rounded-md focus:ring-blue-500 focus:ring focus:ring-offset-2 focus:ring-offset-white"
                    x-model="firstNameValue"
                />
            </div>
            <div class="flex flex-col gap-3">
                <label for="lastName">Last Name:</label>
                <input
                    type="text"
                    name="lastName"
                    id="lastName"
                    placeholder="Last Name . . ."
                    class="w-full h-full p-2 border-2 rounded-md focus:ring-blue-500 focus:ring focus:ring-offset-2 focus:ring-offset-white"
                    x-model="lastNameValue"
                />
            </div>
            <div class="flex flex-col gap-3">
                <label for="age">Age:</label>
                <input
                    type="text"
                    name="age"
                    id="age"
                    placeholder="Age . . ."
                    class="w-full h-full p-2 border-2 rounded-md focus:ring-blue-500 focus:ring focus:ring-offset-2 focus:ring-offset-white"
                    x-model="ageValue"
                />
            </div>
            <div class="flex flex-col gap-3">
                <label for="nationality">Nationality</label>
                <input
                    type="text"
                    name="nationality"
                    id="nationality"
                    placeholder="Nationality . . ."
                    class="w-full h-full p-2 border-2 rounded-md focus:ring-blue-500 focus:ring focus:ring-offset-2 focus:ring-offset-white"
                    x-model="nationalityValue"
                />
            </div>
        </form>
        <button
            type="button"
            class="text-white bg-gradient-to-br from-blue-500 to-blue-700 hover:from-blue-700 hover:to-blue-900 rounded"
            @click="addPerson();"
        >
            <div
                class="hover:scale-110 px-4 py-1"
                x-text="isInArraySize(data, updateIndexValue - 1) ? 'Update' : 'Add'"
            ></div>
        </button>
    </div>
    <div class="flex flex-col gap-3" x-show="data.length > 0">
        <div
            class="p-3 text-white font-bold bg-gradient-to-br rounded-lg shadow-lg"
            :class="{'from-green-500 to-green-700': isRemoveSuccessResult, 
                'from-red-500 to-red-700': !isRemoveSuccessResult}"
            x-show="removeShowResult"
            x-text="removeResultMessage"
        ></div>
        <form>
            <div class="flex flex-col gap-3">
                <label for="removeIndex">Remove Index:</label>
                <input
                    type="text"
                    name="removeIndex"
                    id="removeIndex"
                    placeholder="Index . . ."
                    class="w-full h-full p-2 border-2 rounded-md focus:ring-blue-500 focus:ring focus:ring-offset-2 focus:ring-offset-white"
                    x-model="removeIndexValue"
                />
            </div>
        </form>
        <button
            type="button"
            class="text-white bg-gradient-to-br from-blue-500 to-blue-700 hover:from-blue-700 hover:to-blue-900 rounded"
            @click="removePerson();"
        >
            <div class="hover:scale-110 px-4 py-1">Remove</div>
        </button>
    </div>
</div>
